# Instukcja ręcznej reinstalacji Oracle 11 w sieci Rossmann v0.5

# Kopiowanie plików instalka oracle w lokalizacji 'C:\Temp\Forcom_App\Oracle' znajdują się wszystkie potrzebne pliki
# Przelogowanie użytkownika systemowego na ras
# Uwaga instalujemy tylko 32 bitowe Oracle
# sprawdzenie architektury bazy danych 'sqlplus' na wszelki wypadek (wszędzie powinna być wersja 32)

select
length(addr)*4 || '-bits' word_length
from
v$process
where
ROWNUM =1;

# wyłączenie usług, przestawienie w tryb wyłączony.

sc config "Forsmann" start= disabled
sc config "MarketService" start= disabled
sc config "cashregisterserver" start= disabled
sc config "ActiveMQ" start= disabled
sc config "StoreTransactionSystem_Service" start= disabled
sc stop "Forsmann"
sc stop "cashregisterserver"
sc stop "Jetty"
sc stop "ActiveMQ"
sc stop "MarketService"
sc stop "StoreTransactionSystem_Service" 
taskkill /f /im SaleConnector.exe
taskkill /f /im StoreTransactionSystem.exe
taskkill /f /im DensoConnector.exe
taskkill /f /im STSEstore.exe
taskkill /f /im BonPrice.exe

# export bazy danych do lokalizacji C:\Temp\

exp market3_user/for8667319com FILE=C:\Temp\m.dmp LOG=C:\Temp\m.log TABLES=PRODUCT;

exp cashregisterserver/for8667319com FILE=C:\Temp\c.dmp LOG=C:\Temp\c.log

# ręczne odinstalowanie Oracle 11

-wyłączenie wszystkich programów mogących trzymać oracla, totalcmd, psexec, sqlplus itp.
-z dodaj usuń programy usuwamy oracla
-jeśli folder C:\oraclexe się nie usunął to ręczne jego usunięcie
-sprawdzenie czy nie ma usług oracla

Można też komendą w PsExec (na Rossmannie działa bez problemu, tylko trzeba duuuużo cierpliwości):

wmic product where name="Oracle Database 11g Express Edition" call uninstall
Po odinstalowaniu powinno zwrócić w CMD wartość :

Method execution successful.
Out Parameters:
instance of __PARAMETERS
{
        ReturnValue = 3010;
};
Dodatkowo trzeba tu jednak ręcznie usunąć wpisy w rejestrze (wszystko zawierające "c:\oraclexe"), wpisy w zmiennej PATH, katalogi...

#zmiana katalogów backupu:

D:
move d:\Backup d:\Backup_old
move d:\ApplicationData\Backup d:\ApplicationData\Backup_old
mkdir d:\Backup
mkdir d:\ApplicationData\Backup
mkdir d:\ApplicationData\Backup\XE
mkdir d:\ApplicationData\Backup\XE\Archivelog
mkdir d:\ApplicationData\Backup\XE\Autobackup
mkdir d:\ApplicationData\Backup\XE\Backupset
mkdir d:\ApplicationData\Backup\XE\Logs

#instalacja
-instalacja z setup.exe , katalog C:\oraclexe, hasło ossefros, (pomijamy błąd - The installer is unable to instantiate the file (...)*.reg)

#założenie użytkowników, konfiguracja, wciągnięcie dumpa. Pliki znajdują się w c:\Temp\Forcom_App\Oracle 11 XE 64 bit\Stuff\

sqlplus sys as sysdba/ossefros @configure_database.sql
sqlplus sys as sysdba/ossefros @change_.sql
sqlplus sys as sysdba/ossefros @create_users.sql
sqlplus sys as sysdba/ossefros @create_Rossmann_users.sql
sqlplus sys as sysdba/ossefros @DEVICE_grant_to_Rossmann_users.sql (@5.sql)

-'(w tym momencie nie założą się widoki więc tylko założymy użytkownika)'

imp market3_user/for8667319com FILE=C:\Temp\m.dmp LOG=C:\Temp\m_imp.log
imp cashregisterserver/for8667319com FILE=C:\Temp\c.dmp LOG=C:\Temp\c_imp.log

'jeszcze raz wykonujemy żeby pozakładał widoki wcześniej walnie błędem:'
@create_Rossmann_users.sql

# włączenie usług
sc config "ActiveMQ" start= auto
sc config "Forsmann" start= auto
sc config "MarketService" start= auto
sc config "cashregisterserver" start= auto
sc config "StoreTransactionSystem_Service" start= auto
net start "ActiveMQ"
net start "Forsmann"
net start "MarketService"
net start "cashregisterserver"
net start "Jetty"

#Przelogowanie na użytkownika Rossmann
login: Rossmann hasło: Rossmann
uruchomienie marketu zalogowanie na użytkownika rossmann hasło:
sprawdzenie widżetu Status systemu (odczekać 1 minutę), kolejka komunikatów
